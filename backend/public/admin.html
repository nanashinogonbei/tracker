<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ - Webãƒˆãƒ©ãƒƒã‚«ãƒ¼</title>
	<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
	<div class="min-h-screen flex">
		<aside class="w-64 bg-white min-h-screen border-r">
			<div class="p-6">
				<button class="w-full px-4 py-2 text-sm border rounded mb-2">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§</button>
				<div class="mt-4 space-y-1">
					<div class="px-4 py-2 text-sm">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†</div>
					<div class="px-4 py-2 text-sm text-gray-500">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†</div>
				</div>
			</div>
		</aside>

		<main class="flex-1 p-8">
			<h1 class="text-2xl font-bold mb-8">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§</h1>
			<div id="projects-list" class="space-y-4 mb-8"></div>
			<button id="create-btn" class="bg-blue-500 text-white px-6 py-3 rounded hover:bg-blue-600">
				æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
			</button>
		</main>
	</div>

	<script>
		const API_URL = '/api';

		async function loadProjects() {
			try {
				const res = await fetch(`${API_URL}/projects`);
				const projects = await res.json();
				
				const list = document.getElementById('projects-list');
				list.innerHTML = projects.map(project => `
					<div class="bg-white rounded-lg shadow p-6 flex items-start gap-6">
						<div class="w-32 h-24 bg-gray-300 rounded flex-shrink-0"></div>
						
						<div class="flex-1">
							<h3 class="font-bold text-lg mb-1">${project.name}</h3>
							<p class="text-sm text-gray-600 mb-3">${project.url}</p>
							<div class="flex gap-4">
								<a href="analytics.html?id=${project._id}" class="text-blue-500 text-sm hover:underline">ABãƒ†ã‚¹ãƒˆ</a>
								<a href="analytics.html?id=${project._id}" class="text-blue-500 text-sm hover:underline">ã‚¢ã‚¯ã‚»ã‚¹è§£æ</a>
							</div>
						</div>

						<div class="flex-shrink-0">
							<div class="text-sm font-medium mb-2">SDK</div>
								<div class="bg-gray-50 p-3 rounded text-xs font-mono mb-2 max-w-md">
									&lt;script src="${window.location.origin}/tag/${project._id}/tracker.js" charset="utf-8"&gt;&lt;/script&gt;
								</div>
							<button data-project-id="${project._id}" class="copy-btn w-full bg-blue-500 text-white px-4 py-2 rounded text-sm hover:bg-blue-600">
								<span>ğŸ“‹ ã‚³ãƒ”ãƒ¼ã™ã‚‹</span>
							</button>
						</div>
					</div>
				`).join('');
			} catch (err) {
				console.error('Failed to load projects:', err);
			}
		}

		// copyCodeé–¢æ•°ã‚’ä¿®æ­£
		function copyCode(projectId, buttonElement) {
			const serverUrl = window.location.origin; // ç¾åœ¨ã®ã‚µãƒ¼ãƒãƒ¼URLã‚’å–å¾—
			const code = `<script src="${serverUrl}/tag/${projectId}/tracker.js" charset="utf-8"><\/script>`;
			navigator.clipboard.writeText(code);
			
			const span = buttonElement.querySelector('span');
			span.textContent = 'âœ“ ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ';
			setTimeout(() => {
				span.textContent = 'ğŸ“‹ ã‚³ãƒ”ãƒ¼ã™ã‚‹';
			}, 2000);
		}

		async function createProject() {
			const name = prompt('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
			const url = prompt('URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: https://example.comï¼‰');
			if (!name || !url) return;

			try {
				await fetch(`${API_URL}/projects`, {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ name, url })
				});
				loadProjects();
			} catch (err) {
				console.error('Failed to create project:', err);
			}
		}

		// ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
		document.getElementById('create-btn').addEventListener('click', createProject);
		
		// delegationã§ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‡¦ç†
		document.getElementById('projects-list').addEventListener('click', (e) => {
			const btn = e.target.closest('.copy-btn');
			if (btn) {
				copyCode(btn.dataset.projectId, btn);
			}
		});

		loadProjects();
	</script>
</body>
</html>